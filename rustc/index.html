<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Edward McFarlane Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Edward McFarlane Blog Atom Feed"><title data-react-helmet="true">Rust on a Beaglebone Blue | Edward McFarlane</title><meta data-react-helmet="true" property="og:title" content="Rust on a Beaglebone Blue | Edward McFarlane"><meta data-react-helmet="true" name="description" content="Beaglebone Blue is an all-in-one linux computer for robotics. Based on the Beaglebone Black with specific integrations for robotics its the perfect dev board. In this post we wrap the extensive C libraries available to make them callable from Rust."><meta data-react-helmet="true" property="og:description" content="Beaglebone Blue is an all-in-one linux computer for robotics. Based on the Beaglebone Black with specific integrations for robotics its the perfect dev board. In this post we wrap the extensive C libraries available to make them callable from Rust."><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/styles.dbf51702.css">
<link rel="preload" href="/styles.912540ba.js" as="script">
<link rel="preload" href="/runtime~main.c8e20ee1.js" as="script">
<link rel="preload" href="/main.a0665534.js" as="script">
<link rel="preload" href="/1.5a826afa.js" as="script">
<link rel="preload" href="/2.e3bf3206.js" as="script">
<link rel="preload" href="/ccc49370.dd4d7205.js" as="script">
<link rel="preload" href="/6121013e.49c44728.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/edward.png" alt="Pic of me"><strong class="navbar__title">Edward McFarlane</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://www.linkedin.com/in/edward-mcfarlane-b5493375/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-linkedin header-logo"></a><a href="https://twitter.com/EdwardMcFarlane" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-twitter header-logo"></a><a href="https://www.instagram.com/edwardmcfarlane/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-instagram header-logo"></a><a href="https://github.com/emcfarlane" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github header-logo"></a><span class="displayOnlyInLargeViewport_2aTZ" aria-label="Dark mode toggle"></span></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/edward.png" alt="Pic of me"><strong class="navbar__title">Edward McFarlane</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://www.linkedin.com/in/edward-mcfarlane-b5493375/" target="_blank" rel="noopener noreferrer" class="menu__link header-linkedin header-logo"></a></li><li class="menu__list-item"><a href="https://twitter.com/EdwardMcFarlane" target="_blank" rel="noopener noreferrer" class="menu__link header-twitter header-logo"></a></li><li class="menu__list-item"><a href="https://www.instagram.com/edwardmcfarlane/" target="_blank" rel="noopener noreferrer" class="menu__link header-instagram header-logo"></a></li><li class="menu__list-item"><a href="https://github.com/emcfarlane" target="_blank" rel="noopener noreferrer" class="menu__link header-github header-logo"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_1mse">Rust on a Beaglebone Blue</h1><div class="margin-vert--md"><time datetime="2020-03-01T00:00:00.000Z" class="blogPostDate_3bQP">March 1, 2020  Â· 4 min read</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"></div></div></header><section class="markdown"><p>Beaglebone Blue is an all-in-one linux computer for robotics. Based on the Beaglebone Black with specific integrations for robotics its the perfect dev board. In this post we wrap the extensive C libraries available to make them callable from Rust.</p><p><img alt="Beaglebone Blue" src="/assets/images/beaglebone-bce9065737145065d71c0fff2caa8a5c.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="generate-c-bindings"></a>Generate C Bindings<a aria-hidden="true" tabindex="-1" class="hash-link" href="#generate-c-bindings" title="Direct link to heading">#</a></h2><p>We need to generate C bindings to <a href="https://github.com/StrawsonDesign/librobotcontrol" target="_blank" rel="noopener noreferrer">librobotcontrol</a>.
Thankfully Rust has fantastic tooling to autogenerate FFI C bindings with <a href="https://github.com/rust-lang/rust-bindgen" target="_blank" rel="noopener noreferrer">rust-bindgen</a>.
However we are <em>not</em> going to use the library feature as that requires the C libraries to be present at build. Instead we will generate the binding file ahead of time an statically link against the compiled C lib.</p><p>Boot up the beaglebone blue and login to a shell (<code>mosh debian@beaglebone.local</code>).
Install <a href="https://rust-lang.github.io/rust-bindgen/command-line-usage.html" target="_blank" rel="noopener noreferrer">bindgen</a>.
Git clone <a href="https://github.com/StrawsonDesign/librobotcontrol" target="_blank" rel="noopener noreferrer">librobotcontrol</a>, running the following:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ git clone git@github.com:StrawsonDesign/librobotcontrol.git</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cd librobotcontrol</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ bindgen include/robotcontrol.h -o bindings.rs -- -Iinclude/</span></div></div></div></div></div><p>If successful we now have a new file <code>bindings.rs</code>!</p><p>Now we have bindings lets create the library to link against. Compilation is easy and all setup with the default Beaglebone Blue distribution. Compile with <code>make</code>. Then create an archive with <code>ar</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ make</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ ar rcs librobotcontrol.a build/**.o</span></div></div></div></div></div><p><em>NB: librobotcontrol is already complied in your Beaglebone distribution</em></p><p>Copy these files back to your main computer and lets move on to compiling our Rust program against this.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="linking"></a>Linking<a aria-hidden="true" tabindex="-1" class="hash-link" href="#linking" title="Direct link to heading">#</a></h2><p>To compile our C libraries in rust we will need a <a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html" target="_blank" rel="noopener noreferrer">build script</a>.
Placing the file <code>build.rs</code> in the root of a package will cause Cargo to compile the script and execute it just before building.</p><p>With a file layout:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”œâ”€â”€ build.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”œâ”€â”€ librobotcontrol.a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”œâ”€â”€ src</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚Â Â  â”œâ”€â”€ main.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">â”‚Â Â  â”œâ”€â”€ bindings.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">.   .</span></div></div></div></div></div><p>Where <code>bindings.rs</code> and <code>librobotcontrol.a</code> were generated on the Beaglebone Blue.</p><p>The build script provides the static link:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// build.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use std::env;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">use std::path::Path;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn main() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let dir = env::var(&quot;CARGO_MANIFEST_DIR&quot;).unwrap();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    println!(&quot;cargo:rustc-link-lib=static=robotcontrol&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    println!(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        &quot;cargo:rustc-link-search=native={}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Path::new(&amp;dir).display()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>In <code>main.rs</code> we can now include our new bindings:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// main.rs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#![allow(non_upper_case_globals)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#![allow(non_camel_case_types)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#![allow(non_snake_case)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">include!(&quot;bindings.rs&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg(all(target_os = &quot;linux&quot;))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn main() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let c_str = unsafe {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        let s = rc_version_string();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        assert!(!s.is_null());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        CStr::from_ptr(s)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let r_str = c_str.to_str().unwrap();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    println!(&quot;Success version: {}!&quot;, r_str);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg(any(not(target_os = &quot;linux&quot;)))]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn main() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    println!(r#&quot;Invalid compile target!&quot;#);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cross-compile"></a>Cross Compile<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cross-compile" title="Direct link to heading">#</a></h2><p>Our build target is the AM335x 1GHz ARMÂ® Cortex-A8. To easily compile natively the Rust tools team provides <a href="https://github.com/rust-embedded/cross" target="_blank" rel="noopener noreferrer">cross</a>. This encapsulates the required environment in docker making cross compilation easy. Install cross and build with:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ cross build --target armv7-unknown-linux-gnueabihf</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="calling-back-to-rust-from-c"></a>Calling back to Rust from C<a aria-hidden="true" tabindex="-1" class="hash-link" href="#calling-back-to-rust-from-c" title="Direct link to heading">#</a></h2><p>A core part of the Robotics feature is the IMU_MPU wich includes accelerometers, gyros and barometers. The provided C library has a callback function with the following C signature:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-c codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">rc_mpu_set_dmp_callback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>In Rust, bingen translates this to:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">extern &quot;C&quot; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn rc_mpu_set_dmp_callback(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        func: ::std::option::Option&lt;unsafe extern &quot;C&quot; fn()&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ) -&gt; ::std::os::raw::c_int;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>To call back into Rust from C code we need to provide a function which compiles to C&#x27;s ABI. Unfortunately closures aren&#x27;t able to provide this without a <a href="https://blog.seantheprogrammer.com/neat-rust-tricks-passing-rust-closures-to-c" target="_blank" rel="noopener noreferrer">trampoline function</a>. However, the provided C API doesn&#x27;t allow this trampolining as the arguments aren&#x27;t passed in the callback. We therefore resort to using global state, breaking the Rust thread safety guarantees. Each function that touches this memory will need to be wrapped in unsafe.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">static mut mpu_data: rc_mpu_data_t = rc_mpu_data_t {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    accel: [0.0; 3usize],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    gyro: [0.0; 3usize],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    mag: [0.0; 3usize],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    temp: 0.0,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">unsafe extern &quot;C&quot; fn mpu_callback() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Read access is only safe in this function.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    println!(&quot;Acceleration: {}!&quot;, mpu_data.accel);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p>Where the function can be registered with:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    unsafe { rc_mpu_set_dmp_callback(Some(mpu_callback)) };</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="monitoring"></a>Monitoring<a aria-hidden="true" tabindex="-1" class="hash-link" href="#monitoring" title="Direct link to heading">#</a></h2><p>As a quick demonstration we can expose these metrics via Promethues. Create a GuageVec for acceleration. On each callback update the guage parameters for all 3 dimensions x, y and z:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-rust codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">lazy_static! {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    static ref ACCELERATION: GaugeVec =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        register_gauge_vec!(&quot;acceleration&quot;, &quot;Acceleration in m/s^2&quot;, &amp;[&quot;dimension&quot;]).unwrap();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">unsafe extern &quot;C&quot; fn mpu_callback() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ACCELERATION</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .with_label_values(&amp;[&quot;x&quot;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .set(mpu_data.accel[0]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ACCELERATION</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .with_label_values(&amp;[&quot;y&quot;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .set(mpu_data.accel[1]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ACCELERATION</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .with_label_values(&amp;[&quot;z&quot;])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        .set(mpu_data.accel[2]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><p><em>NB: MPU acceleration values should be filtered.</em></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># HELP acceleration Acceleration in m/s^2</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># TYPE acceleration gauge</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">acceleration{dimension=&quot;x&quot;} 8.169016064453125</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">acceleration{dimension=&quot;y&quot;} -0.3399766357421875</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">acceleration{dimension=&quot;z&quot;} 5.616797094726562</span></div></div></div></div></div><p><img alt="Grafana image" src="/assets/images/grafana-8468100bec895d2a49565e6c15e5f33a.png"></p><p>We now have our Rust program wrapping an ARM C library enabling easy access to all Beaglebone Blues peripherals!</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/rust">rust</a><a class="margin-horiz--sm" href="/tags/c">c</a><a class="margin-horiz--sm" href="/tags/cross-compile">cross-compile</a></div></footer></article><div><a href="https://github.com/emcfarlane/emcfarlane.github.io/edit/master/blog/2020-03-01-rustc.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ipad-dev"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« An iPad with Tailscale</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/books"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">ðŸ“š Books Â»</div></a></div></nav></div></div><div class="col col--2"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#generate-c-bindings" class="table-of-contents__link">Generate C Bindings</a></li><li><a href="#linking" class="table-of-contents__link">Linking</a></li><li><a href="#cross-compile" class="table-of-contents__link">Cross Compile</a></li><li><a href="#calling-back-to-rust-from-c" class="table-of-contents__link">Calling back to Rust from C</a></li><li><a href="#monitoring" class="table-of-contents__link">Monitoring</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="text--center"><div>Copyright Â© 2020 Edward McFarlane.</div></div></div></footer></div>
<script src="/styles.912540ba.js"></script>
<script src="/runtime~main.c8e20ee1.js"></script>
<script src="/main.a0665534.js"></script>
<script src="/1.5a826afa.js"></script>
<script src="/2.e3bf3206.js"></script>
<script src="/ccc49370.dd4d7205.js"></script>
<script src="/6121013e.49c44728.js"></script>
</body>
</html>